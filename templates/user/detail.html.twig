{%  extends ('layout.html.twig') %}

{% block title %}Détail du profil{% endblock %}

{% block main %}

    {#
    Cette page affiche les informations en fonction de l'id utilisateur

    1ere partie --Cette page receptionne une instance de sortie(contenant une instance de lieu)
    2eme partie --Elle a également besoin d'une liste de participant ayant un L'ID de la sortie

    #}

    <section>

        <div class="container">

            <br>
            {#            Affichage de la photo#}

            {% if picture %}
                <div class="row">
                    <div class="photo center-align">
                        <img src="{{ asset(picturePath)}}" alt="test" width="150" border="rounded">
                    </div>
                </div>
            {% endif %}

            <div class="row">
                <h3 class="titre center-align">{{ user.username }}</h3>
                <br>
            </div>

            <div class="row align-center">

                <div class ="col s5 l3 m3 offset-s1 offset-m4 offset-l4">
                    <label class ="aff_sortie_label">Prénom :</label>
                </div>
                <div class ="col s5 l3 m3">
                    <span>{{ user.prenom }}</span>
                </div>
                <br>
            </div>

            <div class="row">
                <div class ="col s5 l3 m3 offset-s1 offset-m4 offset-l4">
                    <label class ="aff_sortie_label">Nom :</label>
                </div>
                <div class ="col s5 l3 m3">
                    <span><span>{{ user.nom }}</span></span>
                </div>
                <br>
            </div>

            <div class="row">
                <div class ="col s5 l3 m3 offset-s1 offset-m4 offset-l4">
                    <label class ="aff_sortie_label">Téléphone :</label>
                </div>
                <div class ="col s5 l3 m3">
                    <span>{{ user.telephone }}</span>
                </div>
                <br>
            </div>

            <div class="row">
                <div class ="col s5 l3 m3 offset-s1 offset-m4 offset-l4">
                    <label class ="aff_sortie_label">Email :</label><span></span>
                </div>
                <div class ="col s5 l3 m3">
                    <span>{{ user.email }}</span>
                </div>
                <br>
            </div>

            <div class="row">
                <div class ="col s5 l3 m3 offset-s1 offset-m4 offset-l4">
                    <label class ="aff_sortie_label">Site :</label>
                </div>
                <div class ="col s5 l3 m3">
                    <span>{{ user.site.nom }}</span>
                </div>
                <br>
                <br>
            </div>


            {#section modulaire avec bouton "modifier profil" si l'on affiche son propre profil#}
            <div class="row">
                {% if user.id == app.user.id %}
                    <div class ="col s5 l3 m3 offset-s1 offset-m4 offset-l4">
                        <a href="{{ path('user_update') }}">
                            <input type="button" class="btn btn-secondary" name="modifier" value="Modifier">
                        </a>
                    </div>
                    <div class ="col s5 l3 m3">
                        <a href="{{ path('main') }}">
                            <input type="button" class="btn btn-secondary" name="retour" value="Retour">
                        </a>
                    </div>

                {% else %}
                    <div class ="center-align">
                        <a href="{{ path('main') }}">
                            <input type="button" class="btn btn-secondary" name="retour" value="Retour">
                        </a>
                    </div>
                {% endif %}
            </div>
            {#Fin section modulaire#}

            {#section modulaire avec affichage des sorties organisées par l'utilisateur ou auxquelles il participe si l'on affiche son propre profil#}
            {% if user.id == app.user.id %}
                <section>
                    <div class="row">
                        <br>
                        <h5 class="titre center-align">Sorties non publiées</h5>
                    </div>

                    <div class="row">

                        <div class="col s12 l8 m10 offset-l2">

                            <table class="responsive-table centered">
                                <thead>
                                <tr>
                                    <th>Nom de la sortie</th>
                                    <th>Debut de la sortie</th>
                                    <th>Clôture</th>
                                    <th>Inscrits/places</th>
                                    <th>Etat</th>
                                    <th>Inscrit</th>
                                    <th>Organisateur</th>
                                    <th>Actions</th>

                                </tr>
                                </thead>

                                <tbody class="tableBody">
                                {% for outing in outings %}
                                    {% set inscrit = false %}
                                    {% for inscription in  outing.inscriptions %}
                                        {% if user.inscriptions.contains(inscription) %}
                                            {% set inscrit = true %}
                                        {% endif %}
                                    {% endfor %}

                                    <tr>
                                        <td><a href="{{ path('show',{'id':outing.id}) }}">{{ outing.nom }}</a></td>
                                        <td>{{ outing.dateHeureDebut|date('d-m-Y / H:i') }}</td>
                                        <td>{{ outing.dateLimiteInscription|date('d/m/Y') }}</td>
                                        <td>{{ outing.inscriptions.count }} / {{ outing.nbInscriptionsMax }}</td>
                                        <td>{{ outing.etat.libelle }}</td>
                                        <td> {% if  inscrit == true %}

                                            <div>Oui</div>
                                        </td>

                                        {% endif %}
                                        <td> {% if  outing.organisateur.id != user.id %}

{#                                            GESTION DES BOUTONS POUR CHAQUE SORTIE#}
                                            <a href="{{ path('their_details',{'id':outing.organisateur.id}) }}">{{ outing.organisateur.username }}</a>
                                        </td>

                                    {% else %}

                                        <div>{{ outing.organisateur.username }}</div></td>

                                        {% endif %}

                                        <td>

                                            <a href="{{ path('show',{'id':outing.id}) }}">Afficher</a>

                                            {% if  outing.organisateur.id == user.id and outing.etat.id != 6 %}

                                                <a href="{{ path('delete',{'id':outing.id}) }}">Effacer</a>

                                            {% endif %}

                                            {% if  inscrit == false and outing.etat.id <= 2 and (outing.nbInscriptionsMax - outing.inscriptions.count) >= 1 %}

                                                <a href="{{ path('subscribe',{'id':outing.id}) }}">S'inscrire</a>

                                            {% endif %}

                                            {% if  inscrit == true and outing.etat.id <= 2 and outing.organisateur.id != user.id %}

                                                <a href="{{ path('renounce',{'id':outing.id}) }}">Se désister</a>

                                            {% endif %}
                                            {% if  inscrit == true and outing.etat.id == 1 and outing.organisateur.id == user.id %}

                                                <a href="{{ path('publish',{'id':outing.id}) }}">Publier</a>

                                            {% endif %}
                                        </td>
{#                                         FIN GESTION DES BOUTONS POUR CHAQUE SORTIE#}

                                    </tr>

                                {% endfor %}

                                </tbody>
                            </table>


                        </div>
                    </div>
                </section>
            {% endif %}
            {#Fin section modulaire#}


        </div>
    </section>
{% endblock %}

