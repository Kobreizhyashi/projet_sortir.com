{% extends ("layout.html.twig") %}


{% block title %} Ajouter une sortie {% endblock %}



{% block main %}
    <div class="form col s12 l8 m10 xl4  offset-m1 offset-xl4 offset-l2 z-depth-2">
        <label for="choice">Ville concernée :</label>
        <div class="input-field col s12">


            <select class="choice">
                {% for ville in villes %}
                    <option value="{{ ville.id }}" id="{{ ville.id }}">{{ ville.nom }}</option>
                {% endfor %}

            </select>


        </div>
        {{ form_start(outingForm) }}
        {{ form_widget(outingForm) }}
        <div id="buttonAddLieu" class="center-align">
            <button type="button" class="btn pulse adding-places center-align"><i
                        class="material-icons">add_location</i><span>Ajouter un lieu</span>
            </button>
        </div>
        <section class="place-adder" style="display: none;">

            <div id="toHide" class="center-align">
                <div class="input-field col s12">
                    <select id="siteSelection">
                        {% for ville in villes %}
                            <option value="{{ ville.id }}" id="{{ ville.id }}">{{ ville.nom }}</option>
                        {% endfor %}
                        <option value="addCity" id="addCity">Ajouter une ville..</option>
                    </select>

                </div>
                <div class="hiddenCityCreation" style="display: none;">
                    <div class="input-field col s10">
                        <input placeholder="Los Angeles.. Stockholm.. Fais nous rêver !" id="ville" type="text"
                               class="validate">
                        <label for="first_name">Ville :</label>
                    </div>
                    <div class="input-field col s10">
                        <input placeholder="Unique, comme toi <3" id="cpo" type="number"
                               class="validate">
                        <label for="first_name">Code postal :</label>
                    </div>
                </div>


                <div class="input-field col s10">
                    <input placeholder="Aux champs Elysées.. Palapalapa" id="nom" type="text" class="validate">
                    <label for="first_name">Nom</label>
                </div>
                <div class="input-field col s10">
                    <input placeholder="Place des grands hommes (dans 10 ans)" id="adresse" type="text"
                           class="validate">
                    <label for="first_name">Adresse</label>
                </div>
                <div class="input-field col s10">
                    <input placeholder="123" id="long" type="number" class="validate">
                    <label for="first_name">Longitude</label>
                </div>
                <div class="input-field col s10">
                    <input placeholder="456" id="lat" type="number" class="validate">
                    <label for="first_name">Latitude</label>
                </div>
                <button type="button" id="validePlaceCreation" style="margin-bottom: 5px;"
                        class="btn waves-effect waves-light btn-small center-align">Un nouveau Lieu !
                </button>


            </div>
        </section>

<div class="center-align">
        <button type="submit" class="btn waves-effect waves-light validatorOuting">Ajouter</button>
        <a href="{{ path('main') }}" class="delete-btn btn waves-effect waves-light">Annuler</a>
</div>
        {{ form_end(outingForm) }}
    </div>
    <script>

        $(document).ready(function () {
            $('.pulse').click(function () {
                $('.validatorOuting').prop('disabled', true);
                $('.place-adder').slideToggle("slow");

            });
        });

        $('#siteSelection').change(function () {
            if ($(this).val() === 'addCity') {
                $('.hiddenCityCreation').slideToggle("slow");
            }
        });


        $('#validePlaceCreation').click(function (e) {


            $.ajax({
                url: '{{ path('ajaxSiteAdd') }}',
                type: 'POST',
                data: {
                    'ville': $('#ville').val(),
                    'cpo': $('#cpo').val(),
                    'siteSelected': $('#siteSelection').val(),
                    'nom': $('#nom').val(),
                    'adresse': $('#adresse').val(),
                    'long': $('#long').val(),
                    'lat': $('#lat').val(),
                },

                async: true,
                dataType: 'json',
                success: function (data) {
                    if (data.backCall === false) {
                        $('.validatorOuting').prop('disabled', false);
                        $('#toHide').empty().append($('<p style="color: #4caf50;"> Le lieu a été ajouté à la liste.</p>'));
                        $('.choice').append($('<option value="' + data.id + '" id="' + data.id + '" selected>' + data.nom + '</option>'));
                        $('.choice').change();
                    } else {
                        $('.validatorOuting').prop('disabled', false);
                        $('#toHide').empty().append($('<p style="color: #4caf50;"> Le lieu a été ajouté à la liste.</p>'));
                        $('.choice').change();
                    }
                },
                error: function (e) {

                    console.log(e);
                    $('#toHide').append($('<p style="color: #AF2E2B;"> Une erreur s\'est produite..Vous avez surement oublié un champ.</p>'));
                }
            });
            e.preventDefault();
        });


        $('.choice').change(function (e) {
            var choice = $(this).val();
            $.ajax({
                url: '{{ path('ajaxFormAdd') }}',
                type: 'POST',
                dataType: 'json',
                data: {
                    'choice': choice
                },
                async: true,
                success: function (data) {

                    $('.ajaxSite').empty();
                    $.each(data, function (id, lieu) {
                        $('.ajaxSite').append($('<option value="' + id + '">' + lieu + '</option>'));

                    });
                }
            });
            e.preventDefault();
        });
    </script>



{% endblock %}

